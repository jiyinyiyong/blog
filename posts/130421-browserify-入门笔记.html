<title>130421-browserify-入门笔记.md</title><meta charset='utf-8'><link rel='stylesheet' href='../src/page.css' /><link rel='stylesheet'  href='http://softwaremaniacs.org/media/soft/highlight/styles/github.css'><div class='home'><a href='../index.html '>Home</a></div><div class='article'><h2>Browserify + coffeeify 的前端调试方案</h2>
<p>文章原在 coffee-js/Languages 的 Issues 里边, 转移过来<br><a href="https://github.com/coffee-js/languages/issues/5">https://github.com/coffee-js/languages/issues/5</a></p>
<h4>SPM 更新</h4>
<p>开头还是留给 <a href="http://weibo.com/1748374882/zqaz6pYMG">spm2</a> 发布的广告, 期待能快壮大起来<br>同时 <a href="http://cdn.menkr.com/index.html">CDN</a> 也提前放出来, 尽管和 spmjs 源是分开的, 还是觉得挺有意思<br>我觉得编程就应该更简单, 因此对 CommonJS 语法的喜爱远胜 AMD<br>SeaJS 的语法不错... 可惜种种原因我个人做玩具首选 Browserify 了</p>
<h4>Browserify</h4>
<p><a href="https://github.com/substack/node-browserify">Browserify</a> 看这里, 按描述上它是用 Node 自身的模块机制来加载模块的<br>模块编译成一个比如 <code>build.js</code> 文件, 浏览器这样只要一个 JS 文件较好了<br>和 Component 项目的不同是这里用的 Node 模块, 而不是另外的办法</p>
<p>使用时要用 <code>browserify main.js &gt; bundle.js</code> 这样的命令进行一次编译<br>在 <code>main.js</code> 里 <code>require</code> 的其他文件, 会被自动加载过来, 打包到 <code>bundle.js</code> 里<br><code>browserify</code> 命令有更多的参数, 具体就看 README 的说明了<br>除了 NPM 上安装的模块, 部分 Node 官方模块按文档有浏览器版本直接可用<br>注意的是 <code>watch</code> 命令在<a href="https://github.com/substack/node-browserify/issues/210">某个版本移除了, 不知什么时候回来</a></p>
<p>重要的一点是 <a href="https://github.com/substack/node-browserify/issues/259">SourceMap 支持</a>, Component 文档里就没说<br>Browserify 似乎是一个月前有的 SourceMap 支持, 这以后意义就不同了<br>加上 <code>-d</code> 参数, 生成的 <code>.js</code> 脚本就一段 dataURL 形式的 sourceURL 注释<br>注意开启 Chrome 调试工具的 Enable SourceMap 选项, 然后开始吧</p>
<h4>coffeeify</h4>
<p>Browserify 支持一些<a href="https://github.com/substack/node-browserify#list-of-source-transforms">插件</a>, 可以把其他代码编译到 JS 当中去<br>对我来说, 主要就是 <a href="https://github.com/substack/coffeeify">coffeeify</a> 了, 支持 CoffeeScript 的插件<br>不过现在几个不好, 一个是[模块需要在本地安装才行, 否则会报错]<br>还有是[需要 <code>.coffee</code> 后缀写好, Browerify 才能识别], 而不像 Node 中那样<br>另外目前<a href="https://github.com/substack/coffeeify/issues/7">有行号的 bug, 在当前的 coffee <code>v1.6.2</code> 版本中会出错</a><br>不过按链接说的, 其实 bug 已经修复, 手动才 Github 下载模块替换是可以解决的</p>
<p>这样就能在 Chrome 终端直接看 <code>.coffee</code> 代码了, 第一次单步调试 coffee :sparkling_heart:<br>不太好的是 @substack <a href="https://github.com/substack/coffeeify#maintainers-wanted">大神本人不写 coffee, README 有提到</a><br>另外写 coffee 的倒是有 <a href="https://github.com/michaelficarra/commonjs-everywhere">commonjs-everywhere</a> 作者写出来东西<br>后者, 上次我尝试了没能玩转, 只好往后更新出来的详细文档了, 期待啊</p>
<h4>我的尝试</h4>
<p>我的 <a href="https://github.com/jiyinyiyong/snowflake">snowflake</a> 是对此的一个尝试吧, 昨晚调试行号我没调整好的<br>感觉轻松多... 不过外部模块调用我没尝试, 到时也许有些问题, 再看<br>另外我的自动编译和浏览器刷新, <code>browserify</code> 的 <code>watch</code> 参数没好, 绕了点弯子<br>但以后, 保存代码, 浏览器自动刷新那是必须, 必须把工具做好</p>
<h4>asm.js</h4>
<p>跑题... ASM 的速度好快, JS 编译都常态啊. 各种编译<br><a href="http://blog.skeeterhouse.com/9032.html">http://blog.skeeterhouse.com/9032.html</a><br><a href="http://kripken.github.com/mloc_emscripten_talk/#/">http://kripken.github.com/mloc_emscripten_talk/#/</a><br><a href="http://asmjs.org/faq.html">http://asmjs.org/faq.html</a></p>
<hr>
<p>近几天看了下 <code>commonjs-everywhere</code> 的用法, 觉得可以考虑尝试了<br><a href="https://github.com/michaelficarra/commonjs-everywhere">https://github.com/michaelficarra/commonjs-everywhere</a><br>相对于 <code>browserify</code> 来说的确有一些难得的优点:</p>
<ul>
<li>命令有 <code>watch</code> 参数, 关注依赖的内容自动编译, 省了一些麻烦</li>
<li>对 CoffeeScript 支持更好, 不需要后缀, 作者本身就是写 coffee 的</li>
<li>部分 Browserify 没有自带的 Node 模块在这里是默认的, 方便一些</li>
</ul>
<p>麻烦当然有还不少:</p>
<ul>
<li><code>watch</code> 过程中如果出现错误, 整个程序就会挂掉</li>
<li>依赖的是 CoffeeScriptRedux, 文档不多, <a href="https://github.com/michaelficarra/CoffeeScriptRedux/tree/master/test"><code>test/</code></a> 下的代码看来和 coffee 语法有区别</li>
<li><a href="https://github.com/michaelficarra/CoffeeScriptRedux/issues/83">Redux 的函数参数不允许换行, 大概是 Bug</a>, 以后应该会好的</li>
<li>我现在的 <code>index.html build.js</code> 以及编译命令需要在同一路径, 不清楚剧场限制..</li>
</ul>
<p>相对来说我探索的还太少, <code>cjsify</code> 是暴露 AST 的, 信息量更多<br>话说回来这名字取得, 其实也是 <code>browserify</code> 的一个相似方案<br>很多模块应该也是可一样 <code>require</code> 的, 以后再看吧</p>
</div><div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'jiyinyiyong';
      // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script');
          dsq.type = 'text/javascript';
          dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          if (document.getElementsByTagName('head')[0]) {
            document.getElementsByTagName('body')[0].appendChild(dsq);
          }
      })();
  </script>
  <noscript>
    Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">
      comments powered by Disqus.
    </a>
  </noscript>
  <a href="http://disqus.com" class="dsq-brlink">
    comments powered by
    <span class="logo-disqus">
      Disqus
    </span>
  </a>
</div><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41753901-1', 'jiyinyiyong.github.io');
  ga('send', 'pageview');
</script>