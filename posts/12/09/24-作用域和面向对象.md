
### 作用域和面向对象的想法

学了些面向对象, 原先的对于作用域的理解还是在继续困惑
JS 的语言设计, 虽然原型链慢慢暴露出来, 可按学长的说法原型链应该是隐藏的
对方不是 FP 的拥趸, 我也不以为然, 可整个 OO 的成功我无法忽视
JS 这条路我走了好久, 依然惨淡, 问题无法定位到行
也出在无法实现大规模的项目, 以及没有真正能拿出手的开发范例
或者开发真的靠天赋加经验的话, 我是真的难以做到的

抛开不安和困惑, 此前一个极端的想法是这样的, 面向对象是词法作用域的延伸
的确我没有足够的论据, 这是我纯粹的一个想法:

函数式编程里函数内嵌函数时, 搜索作用域是向父作用域递归搜索的
JS 原型链的搜索方式, 也是从对象往原型, 再往上边的原型进行搜索
相同之处就是对于数据的检索, 按说目的是为了节省方法属性带来的空间
我花了相当长时间去了解 `prototype` 在 JS 当中怎样运作, 越发觉得神奇
我的看法, 对于程序就是应该怎样高效得管理和操作变量
而原型链的用法在静态词法域之上添加了新的可能性
即便 JS 当中出现了混乱, 整个还是值得赞叹和模仿的

一个代码的例子比如:

```coffee
obj = (name) ->
  @name = name
  @

obj.prototype.echo = -> console.log @name

demo = new obj 'demo'
demo.echo()

demo_2 = new obj 'demo_2'
demo_2.echo()
```

`@` 作为 `this` 指针, `obj` 函数作为构造器, 创建了一个类
而换做函数式的写法, 大概是这样的:

```coffee
demo1 =
  name: 'demo1'

demo2 =
  name: 'demo2'

echo = (obj) -> console.log obj.name

echo demo1
echo demo2
```

我初步想到的区别在于 `echo` 作为变量在 `obj` 增多时带来重复的可能
比如浏览器里的标签. 很多标签拥有不一样的方法和属性, 变量名就会麻烦
接着再比如标签之间相似度非常大的时候, 相比将对象进行复制,
联想到推上讨论的, OO 中引用也可以节省一定内存使用

不过 OO 的代码, 特别是 `new` 的关键字让我觉得非常不清晰
可能囿于 JS 的局限, Python 的 `class` 有很大的不同
只是我的考虑的话, Python 的类在语言中做了隐藏, 使一个让我会好奇张望的地方
因为明确了细节的时候我可以清晰地用我的自己的思路去思考问题
如果有个很抽象的 `class` 存在, 我恐怕不得不往 `class` 靠近和抽象
而且我非常觉得我做不好. 反观原型链就稍微更灵活一些
我不确定一门语言究竟该强大还是灵活更能实用中胜任
只是一贯以来我的方向, 我比较排斥工具本身的复杂

再回到当时 Lispy 教程里的作用域递归搜索变量之后,
我觉得用对象保存的作用域本身其实也应当是语言中能够操作的数据结构
当然我们能操作, 定义变量, 读取变量, 这些都可以在语言中完成
我更远的想法是将作用域显式声明一遍, 再像对象继承一般进行继承

```coffee
s_0 =
  name: 's_0'
  echo: (x) -> console.log x
  echo 'run this function'
  intro: -> echo %parent.name
s_1 = extending s_0,
  echo 'call `echo` of s_0'
  %name: 's_2'
  intro() # 's_2'
s_3 = extending s_2, (x, y) ->
  echo x, y
s_0.s_4 = extending s_2, (x, y) ->
  echo x, y
```

伪代码太难看懂.. 主要是这样:
- 显式声明作用域, 赋值时变量绑定在作用域, 并允许点号语法访问
- 通过 `extending` 扩展作用域时, 后者查找变量向父作用域进行搜索
- 作用域也可以是函数, 如 `s_3` , 在接收变量后才执行并返回最后一个值
- 通过点号语法允许新声明的作用域作为函数绑定到对应作用域上
再添加机制, 用来模拟类的功能, 同时不压缩函数式的习惯
虽然仅仅一个朦胧想法还是无法成为一种编程的方式

我现在并不清晰 OO 在语言中是怎样实现的, 现在开始好奇
能不能把作用域变成可以传递的一种数据结构, 这是我所想的
