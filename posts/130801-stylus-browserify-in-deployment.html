<title>130801-stylus-browserify-in-deployment.md</title><meta charset='utf-8'><link rel='stylesheet' href='../src/page.css' /><link rel='stylesheet'  href='http://softwaremaniacs.org/media/soft/highlight/styles/github.css'><div class='home'><a href='../index.html '>Home</a></div><div class='article'><h2>基于 Stylus 和 Browserify 前端代码的想法</h2>
<p>我从前想的是学会快速做各种原型给人展示我的想法就好了, 而不是维护<br>自己买 VPS 遇到被墙也只能不了了之, 代码压缩的场景也没有深入过<br>开源代码, 特别 JS 依靠源码明文传输, 压缩代码主要是网速的意义了<br>今天早上看 Bret Victor 的视频, 觉得一张白纸, 被错误观念影响很小还走运<br>晚上吐槽前端环境太复杂, 被指出基础不够扎实.. 唉, 总是要圣火在现实里的</p>
<h3>SeaJS 相关</h3>
<p><img src="https://f.cloud.github.com/assets/661559/840596/ce1b55e4-f377-11e2-859c-ed1172ed632a.png" alt="seajs"></p>
<p>很久都想尝试 <a href="http://seajs.org">SeaJS</a>, 因为有国内社区的氛围, 比起 @substack 近多了<br>SeaJS 一直以来文档不全, 这个夏天才看到 Issue 里排了相关计划<br>我近几天搜索网上博客, 零零散散介绍 SeaJS 有很多了, 只是 SeaJS 改版了<br>浏览器端按文件加载的语法不难, 文档很详细 <a href="https://github.com/seajs/seajs/issues/242">https://github.com/seajs/seajs/issues/242</a><br>又接触到 Arale, 看到底部的导航, 之间的关系懂了个大概</p>
<pre><code>Arale • Alice • Sea<span class="variable">.js</span> • spmjs<span class="variable">.org</span> • nico</code></pre>
<p>Arale 是 JS 基础库, Alice 是 UI 框架, SPM 是打包, Nico 是文档</p>
<p><img src="http://aralejs.org/static/arale.jpg" alt="arale"><br><img src="http://aliceui.org/static/alice_by_meago.png" alt="alice"></p>
<p>有时间再啃一下 Alice 和 Arale 的文档, 怕都有惊喜的感觉<br>看 Issue 里说的, SeaJS 不少相关文档散落在这两个站点里边</p>
<p>当前我比较着急的是合并部署代码相关的文档, SPM 的文档相对是最缺的<br>由于改版, 采用了 Grunt, 加上支付宝并不是国外社区那样很多闲人参与<br>旧的文档大多不能在 SPM2 对应看, 现在主要剩下 <a href="https://spmjs.org/">https://spmjs.org/</a> 的几篇<br>另外关于代码合并, <a href="http://chaoskeh.com/blog/why-its-hard-to-combo-seajs-modules.html">为什么 SeaJS 模块的合并这么麻烦</a>文章里做了比较清晰的解释<br>主要是简略的写法, 导致代码不能直接有 id 的命名空间, 需要先 transport<br>transport 以后, 再经过 concat 和 uglify 两个步骤, 才算完成. 打包都把我看晕了</p>
<p>关于 SeaJS 的实现 <a href="https://github.com/Bodule/HelloSea.js">HelloSea.js</a> 的文章写了很长的教程, 非常推荐<br>还可以参考 <a href="https://github.com/zjcqoo/mod/blob/master/mod.js">modjs</a>, <a href="http://madscript.com/modjs/">modjs1</a>重名比较高.. 谁给解释下</p>
<h3><a href="https://github.com/LearnBoost/stylus">Stylus</a> 部署</h3>
<p><img src="http://learnboost.github.io/stylus/assets/stylus.png" alt="stylus-logo"></p>
<p>我遇到的需求不够普遍吧, 没有经验把场景理解很透彻, CSS 是全打包压缩的<br>首先 concat 和 cssmin 通过 Grunt 插件是可以直接做到的<br>但直接管理 CSS 存在问题, 之前我也没想到过这样的不便:</p>
<ul>
<li>没有用 Stylus, SASS 之类方案将 CSS 书写结构化, 修改不方便</li>
<li>页面引用大量 CSS 文件, 以及 Gruntfile, 管理不方便</li>
<li>服务器部署需要单一的 CSS 文件入口, 分散的 CSS 文件又需要合并</li>
<li>CSS 文件代码重用, 文件树管理, 造成了不方便</li>
</ul>
<p>于是想到通过编译文件常用的 join 方式将 CSS 在编译时合并<br>Stylus 支持 <code>@import</code> 语法, 可以在编译时加载 <code>*styl</code> 文件合并<br>对于 <code>.css</code> 文件默认是不合并的, 可以通过 <code>--include-css</code> 来完成开启<br>上边的功能通过对应 <a href="https://github.com/gruntjs/grunt-contrib-stylus">Grunt 插件</a> 可以直接使用</p>
<p>另外 CSS 合并要考虑相对路径图片 url 的转换, 需要额外支持<br>搜索了一下, 在 <a href="https://github.com/Ideame/grunt-css-urls">grunt-css-urls</a> 这个插件有支持<br>命令行有 <a href="https://github.com/GoalSmashers/clean-css">clean-css</a> 可以用, 但估计不适合 Grunt<br>Stylus 最近的 commit 和 help 里有找到 <code>--relative-url</code> 来开启对应功能<br>我<a href="https://github.com/LearnBoost/stylus/issues/1092">尝试</a>了下, 被告知对应文件存在时, Stylus 可以正常工作<br>于是就剩下<a href="https://github.com/gruntjs/grunt-contrib-stylus/issues/49">插件里需要确认下</a>是否已经支持这个功能了</p>
<p>CSS 部分有 Stylus 这些功能支持, 探索暂时告一段落</p>
<h3><a href="http://browserify.org/">Browserify</a> 打包 JS</h3>
<p><img src="http://browserify.org/images/browserify.png" alt="browserify-logo"></p>
<p><a href="http://jiyinyiyong.github.io/blog/posts/130421-browserify-入门笔记.html">之前讲过</a>, 现在唠叨一下吧, 对于喜欢 CommonJS 的人来说, 魅力啊<br>Browserify 通过解析代码, 提取文件的依赖关系, 最后对代码进行打包<br>命令行 <code>browserify main.js -o bundle.js</code> 即可完成打包的过程<br>CoffeeScript 编译需要本地安装 <a href="https://github.com/substack/coffeeify/"><code>coffeeify</code></a> 插件, 还算可以<br>后来发布了 <a href="https://github.com/substack/watchify">watchify</a> 插件填坑做了监视文件保存自动刷新编译的功能<br>加上很久以来的 SourceMap, Chrome 调试已经感觉很好</p>
<p>相关的, <a href="https://github.com/michaelficarra/commonjs-everywhere">commonjs-everywhere</a> 项目因为用了文档不全的 CoffeeScript 2.0<br>我个人受不了 2.0 一些没完善的地方, 估计现在用的人也不会多<br>另外看到有个 <a href="http://github.com/azer/onejs">onejs</a> 和 <a href="https://github.com/mixu/gluejs">gluejs</a> 在 Browserify 上做封装, 没细看<br>对了 Browserify <a href="https://github.com/substack/module-deps/pull/5#issuecomment-19870412">一个模块已经改进了对 <code>.coffee</code> 后缀的识别</a>, <a href="https://github.com/substack/node-browserify/pull/336">期待近期事情有个了结</a></p>
<p>预想里有合并好的 JS 的话, HTML 里引入的 JS 文件可以减少到很多<br>代码管理上, 可能存在其他疏忽, 但希望能避免当前的问题</p>
<h3>还没做测试</h3>
<p>没做过测试, 什么都可能发生. 希望文章对大家有用<br>另外这方面经验很少, 求指点</p>
</div><div id="disqus_thread"></div>
  <script type="text/javascript">
      /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
      var disqus_shortname = 'jiyinyiyong';
      // required: replace example with your forum shortname

      /* * * DON'T EDIT BELOW THIS LINE * * */
      (function() {
          var dsq = document.createElement('script');
          dsq.type = 'text/javascript';
          dsq.async = true;
          dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
          if (document.getElementsByTagName('head')[0]) {
            document.getElementsByTagName('body')[0].appendChild(dsq);
          }
      })();
  </script>
  <noscript>
    Please enable JavaScript to view the
    <a href="http://disqus.com/?ref_noscript">
      comments powered by Disqus.
    </a>
  </noscript>
  <a href="http://disqus.com" class="dsq-brlink">
    comments powered by
    <span class="logo-disqus">
      Disqus
    </span>
  </a>
</div><script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41753901-1', 'jiyinyiyong.github.io');
  ga('send', 'pageview');
</script>